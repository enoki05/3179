{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "projection": {"type": "mercator"},
  "config": {
    "font": "DejaVu Sans Mono",
    "background": "#d1deee",
    "axis": {
      "labelFontWeight": "normal",
      "titleFontWeight": "normal",
      "labelFontSize": 14,
      "titleFontSize": 16
    },
    "view": {
      "stroke": "transparent",
      "padding": {"bottom": 40}
    },
    "style": {
      "tooltip": {
        "font": "DejaVu Sans Mono",
        "fontSize": 12,
        "fontWeight": "normal"
      }
    },
    "title": {
      "fontSize": 18,
      "fontWeight": "bold",
      "font": "DejaVu Sans Mono"
    }
  },
  "spacing": 60,
  "center": true,
  "columns": 2,
  "params": [
    {
      "name": "Category",
      "value": "Industry",
      "bind": {
        "input": "select",
        "options": ["Industry", "Occupation", "State"],
        "labels": ["Industry", "Occupation", "State"],
        "name": "Filter Projections Chart by Category: "
      },
      "expr": "Category"
    },
    {
      "name": "region_selection",
      "value": "Australian Capital Territory",
      "bind": {
        "input": "select",
        "options": [
          "Australian Capital Territory", "New South Wales", "Victoria", 
          "Queensland", "South Australia", "Western Australia", 
          "Tasmania", "Northern Territory"
        ],
        "name": "Filter Recruitment Chart by Region: "
      }
    }
  ],
  "concat": [
    {
      "data": {
        "url": "https://raw.githubusercontent.com/enoki05/3179/refs/heads/main/Week%2010%20HW/data/interactive_data_5.csv"
      },
      "title": {"text": "Employment Projections by Category"},
      "width": 600,
      "height": 400,
      "transform": [
        { "filter": "trim(datum.Category) == Category" },
        {
          "calculate": "toNumber(datum['2029_Projected_Count'])",
          "as": "count_numeric"
        }
      ],
      "layer": [
        {
          "mark": {"type": "bar", "color": "#238b45"},
          "encoding": {
            "x": {
              "field": "Category Type",
              "type": "nominal",
              "title": {"signal": "Category"},
              "axis": {
                "labelFontSize": 14,
                "labelAngle": -40,
                "labelLimit": 400,
                "labelPadding": 10,
                "titlePadding": 35,
                "titleFontWeight":"bold",
                "titleFontSize": 16
              }
            },
            "y": {
              "field": "count_numeric",
              "type": "quantitative",
              "title": "2029 Projected Count (000s)",
              "axis": {
                "titleFontWeight":"bold",
                "titleFontSize": 16,
                "labelFontSize": 14,
                "grid": true,
                "gridColor": "#666666",
                "gridOpacity": 0.2
              }
            },
            "tooltip": [
              {"field": "Category Type", "type": "nominal"},
              {"field": "count_numeric", "type": "quantitative", "format": ",.1d","title": "2029 Projected Count (000s)"}
            ]
          }
        },
        {
        "mark": {"type": "text", "align": "center", "dy": 500, "lineBreak": "\n", "fontSize": 16, "font": "DejaVu Sans Mono"},
        "data": {"values": [{"text": "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore.\nLorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore.\nLorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore."}]},
        "encoding": {"text": {"field": "text"}}
      },
        {
          "transform": [
            {
              "aggregate": [
                {"op": "argmax", "field": "count_numeric", "as": "max_record"}
              ]
            },
            {
              "calculate": "datum.max_record['Category Type']",
              "as": "max_category"
            },
            {
              "calculate": "datum.max_record.count_numeric",
              "as": "max_count"
            }
          ],
          "layer": [
            {
              "mark": {
                "type": "point",
                "shape": "triangle-down",
                "size": 150,
                "color": "#238b45",
                "yOffset": -10
              },
              "encoding": {
                "x": {"field": "max_category", "type": "nominal"},
                "y": {"field": "max_count", "type": "quantitative"}
              }
            },
            {
              "mark": {
                "type": "text",
                "align": "center",
                "fontSize": 15,
                "fontWeight": "bold",
                "color": "#238b45",
                "yOffset": -30,
                "font": "DejaVu Sans Mono"
              },
              "encoding": {
                "x": {"field": "max_category", "type": "nominal"},
                "y": {"field": "max_count", "type": "quantitative"},
                "text": {
                  "value": {
                    "expr": "datum.max_category + ' has the highest count of ' + format(datum.max_count, '.1d')"
                  }
                }
              }
            }
          ]
        }
      ]
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/enoki05/3179/refs/heads/main/Week%2010%20HW/data/area_data.csv"
      },
      "width": 600,
      "height": 400,
      "title": {"text": {"signal": "'Recruitment Rate Over Time for ' + region_selection"}},
      "transform": [
        {
          "calculate": "datetime(2000 + parseInt(split(datum.Quarter, '-')[1]), indexof('  Mar  Jun  Sep  Dec', substring(datum.Quarter, 0, 3)) / 5 * 3, 1)",
          "as": "Date"
        },
        {
          "fold": [
            "New South Wales", "Victoria", "Queensland", "South Australia",
            "Western Australia", "Tasmania", "Northern Territory", "Australian Capital Territory"
          ],
          "as": ["Region", "value"]
        },
        { "filter": "datum.Region == region_selection" },
        {
          "calculate": "toNumber(datum.value)",
          "as": "value_numeric"
        }
      ],
      "layer": [
        {
          "mark": {"type": "area", "line": true, "color": "#bae4b3"},
          "encoding": {
            "x": {
              "field": "Date",
              "type": "temporal",
              "axis": {
                "format": "%b %Y",
                "labelAngle": -45,
                "titlePadding": 25,
                "titleFontWeight":"bold",
                "titleFontSize": 16,
                "labelFontSize": 14,
                "grid": true,
                "gridColor": "#666666",
                "gridOpacity": 0.2
              }
            },
            "y": {
              "field": "value_numeric",
              "type": "quantitative",
              "scale": {"domain": [0, 0.8]},
              "axis": {"tickCount": 5, "grid": false, "format": ".0%","titleFontWeight":"bold", "titleFontSize": 16, "labelFontSize": 14},
              "title": "Recruitment Rate"
            },
            "tooltip": [
              {"field": "Region", "type": "nominal", "title": "Region"},
              {"field": "Date", "type": "temporal", "title": "Date", "format": "%b %Y"},
              {"field": "value_numeric", "type": "quantitative", "title": "Recruitment Rate (%)", "format": ",.1%"}
            ]
          }
        },
        {
        "mark": {"type": "text", "align": "center", "dy": 500, "lineBreak": "\n", "fontSize": 16, "font": "DejaVu Sans Mono"},
        "data": {"values": [{"text": "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore.\nLorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore.\nLorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore."}]},
        "encoding": {"text": {"field": "text"}}
      },
        {
          "transform": [
            {"window": [{"op": "row_number", "as": "row_num"}], "sort": [{"field": "Date", "order": "ascending"}]},
            {"joinaggregate": [{"op": "max", "field": "row_num", "as": "max_row"}]},
            {"filter": "datum.row_num == datum.max_row"}
          ],
          "layer": [
            {
              "mark": {"type": "point", "shape": "circle", "size": 50, "color": "#6082B6", "filled": true},
              "encoding": {
                "x": {"field": "Date", "type": "temporal"},
                "y": {"field": "value_numeric", "type": "quantitative"}
              }
            },
            {
              "mark": {
                "type": "text",
                "align": "right",
                "dx": 10,
                "fontSize": 15,
                "fontWeight": "bold",
                "color": "#6082B6",
                "yOffset": -130,
                "font": "DejaVu Sans Mono"
              },
              "encoding": {
                "x": {"field": "Date", "type": "temporal"},
                "y": {"field": "value_numeric", "type": "quantitative"},
                "text": {
                  "value": {
                    "expr": "'Current amount of companies recruiting is ' + format(datum.value_numeric, '.1%')"
                  }
                }
              }
            }
          ]
        }
      ]
    },
    {
      "width": 600,
      "height": 400,
      "title": {"text": "Employment Rate by Region"},
      "layer": [
        {
          "data": {
            "url": "https://raw.githubusercontent.com/enoki05/3179/refs/heads/main/Week%209%20HW/output.json",
            "format": {"type": "topojson", "feature": "ne_50m_graticules_5"}
          },
          "mark": {"type": "geoshape", "stroke": "gray", "strokeWidth": 0.5, "fill": null}
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/enoki05/3179/refs/heads/main/Week%209%20HW/SA4_2021_AUST_GDA2020%20(1).json",
            "format": {"type": "topojson", "feature": "SA4_2021_AUST_GDA2020"}
          },
          "transform": [
            {
            "calculate": "datum.properties.SA4_NAME21",
            "as": "SA4_NAME21"
          },
            {
              "calculate": "substring(datum.properties.SA4_CODE21, 0, 1)",
              "as": "state_code"
            },
            {
              "lookup": "properties.SA4_NAME21",
              "from": {
                "data": {
                  "url": "https://raw.githubusercontent.com/enoki05/3179/refs/heads/main/Employed_By_Region.csv"
                },
                "key": "SA4 NAME",
                "fields": ["Employed", "Working Age Population"]
              }
            },
            {
              "calculate": "datum.Employed / datum['Working Age Population'] * 100",
              "as": "Employment Rate Percent"
            },
            {
              "calculate": "(datum['Employment Rate Percent'] - 60) / (75 - 60)",
              "as": "Employment Rate Normalized"
            },
            {
              "calculate": "round(datum['Employment Rate Percent'] * 100) / 100 + '%'",
              "as": "Employment Rate"
            }
          ],
          "mark": {"type": "geoshape", "stroke": "black", "strokeWidth": 0.2},
          "params": [{
            "name": "state_click",
            "select": {"type": "point", "fields": ["state_code"]},
            "value": [{"state_code": "1"}]
          }],
          "encoding": {
            "color": {
              "field": "Employment Rate Normalized",
              "type": "quantitative",
              "scale": {
                "type": "threshold",
                "domain": [0.25, 0.5, 0.75],
                "range": ["#edf8e9", "#bae4b3", "#74c476", "#238b45"]
              },
              "legend": {
                "title": "Employment Rate (%)",
                "values": [0, 0.25, 0.5, 0.75, 1],
                "format": ".1f",
                "orient": "right",
                "offset": 40,
                "direction": "vertical",
                "labelExpr": "60 + datum.value * 15"
              }
            },
            "tooltip": [
              {"field": "properties.SA4_NAME21", "type": "nominal", "title": "Region"},
              {"field": "Employment Rate", "type": "nominal"}
            ]
          }
        }
      ]
    },
    {
      "data": {"url": "https://raw.githubusercontent.com/enoki05/3179/refs/heads/main/Employed_By_Region.csv"},
      "width": 600,
      "height": 400,
      "title": {"text": "Regional Labour Market Ratings"},
      "transform": [
        {
          "fold": [
            "17/07/2003", "17/07/2004", "17/07/2005", "17/07/2006", 
            "17/07/2007", "17/07/2008", "17/07/2009", "17/07/2010",
            "17/07/2011", "17/07/2012", "17/07/2013", "17/07/2014",
            "17/07/2015", "17/07/2016", "17/07/2017", "17/07/2018",
            "17/07/2019", "17/07/2020", "17/07/2021", "17/07/2022",
            "17/07/2023", "17/07/2024", "17/07/2025"
          ],
          "as": ["Year", "Rating"]
        },
        {
          "calculate": "substring(datum.Year, 6, 10)",
          "as": "YearLabel"
        },
        {
          "calculate": "toNumber(datum.Rating)",
          "as": "RatingNumeric"
        },
        { "calculate": "substring(datum['SA4 Code'], 0, 1)","as": "state_code"},
        { 
          "filter": "!length(data('state_click_store')) || datum.state_code == state_click.state_code"
        }
      ],
      "mark": "rect",
      "encoding": {
        "x": {
          "field": "YearLabel",
          "type": "ordinal",
          "title": "Year",
          "axis": {
            "labelAngle": -45,
            "labelFontSize": 14,
            "titleFontWeight":"bold",
            "titleFontSize": 16
          }
        },
        "y": {
          "field": "SA4 NAME",
          "type": "nominal",
          "title": "Region",
          "axis": {
            "labelLimit": 200,
            "labelFontSize": 14,
            "titleFontWeight":"bold",
            "titleFontSize": 16,
            "titleAlign": "right",
            "titleAngle": 0,
            "titleX": -10,
            "titleY": -10
          }
        },
        "color": {
          "field": "RatingNumeric",
          "type": "quantitative",
          "scale": {
            "scheme": "greens",
            "domain": [1, 5]
          },
          "legend": {
            "title": "Rating",
            "orient": "right",
             "direction": "vertical",
             "titleAnchor": "end",
              "offset": 40 
          }
        },
        "tooltip": [
          {"field": "SA4 NAME", "type": "nominal", "title": "Region"},
          {"field": "YearLabel", "type": "nominal", "title": "Year"},
          {"field": "RatingNumeric", "type": "quantitative", "title": "Rating", "format": ".2f"}
        ]
      }
    }
  ]
}