{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "background": null,
  "config": {
    "font": "Fira Sans Condensed, sans-serif",
    "view": {"stroke": null},
    "title": {"fontSize": 18, "fontWeight": "bold", "font": "Fira Sans Condensed, sans-serif"}
  },
  "spacing": 120,
  "params": [
    {
      "name": "Year_Selection",
      "value": 2025,
      "bind": {
        "input": "range",
        "min": 2020,
        "max": 2025,
        "step": 1,
        "name": "Choose Year:"
      }
    }
  ],
  "hconcat": [
    {
      "width": 500,
      "height": 400,
      "title": {"text": "Reason for Recruiting", "anchor": "middle", "fontSize": 18},
      "data": {
        "url": "https://raw.githubusercontent.com/enoki05/3179/refs/heads/main/data/Recruitment_Reason.csv"
      },
      "transform": [
        {"calculate": "substring(datum.Year, 6, 10)", "as": "YearNumber"},
        {"calculate": "toNumber(datum.YearNumber)", "as": "YearNumeric"},
        {"filter": "datum.YearNumeric == Year_Selection"},
        {
          "fold": [
            "Turnover Only",
            "Both Turnover and New Position(s)",
            "New Position(s) only "
          ],
          "as": ["Reason", "Percentage"]
        },
        {"calculate": "trim(datum.Reason)", "as": "ReasonClean"},
        {"calculate": "trim(datum.Percentage)", "as": "PercentageTrimmed"},
        {"calculate": "replace(datum.PercentageTrimmed, '%', '')", "as": "PercentageClean"},
        {"calculate": "toNumber(datum.PercentageClean)", "as": "PercentageNumeric"}
      ],
      "layer": [
        {
          "mark": {
            "type": "arc",
            "innerRadius": 100,
            "outerRadius": 180,
            "stroke": "#fff",
            "strokeWidth": 3
          },
          "encoding": {
            "theta": {"field": "PercentageNumeric", "type": "quantitative"},
            "color": {
              "field": "ReasonClean",
              "type": "nominal",
              "scale": {
                "domain": [
                  "Turnover Only",
                  "Both Turnover and New Position(s)",
                  "New Position(s) only"
                ],
                "range": ["#74c476", "#238b45", "#00441b"]
              },
              "legend": {
                "title": "Recruitment Reason",
                "orient": "bottom",
                "direction": "vertical",
                "labelFontSize": 12,
                "titleFontSize": 13,
                "offset": 20,
                "symbolSize": 150,
                "labelLimit": 250
              }
            },
            "tooltip": [
              {"field": "ReasonClean", "type": "nominal", "title": "Reason"},
              {"field": "PercentageNumeric", "type": "quantitative", "title": "Percentage (%)", "format": ".1f"}
            ]
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "center",
            "baseline": "middle",
            "fontSize": 36,
            "fontWeight": "bold",
            "color": "#238b45"
          },
          "encoding": {"text": {"field": "YearNumeric"}}
        }
      ]
    },
    {
      "width": 500,
      "height": 400,
      "title": {"text": "Recruitment Difficulties", "anchor": "middle", "fontSize": 18},
      "data": {
        "url": "https://raw.githubusercontent.com/enoki05/3179/refs/heads/main/data/recruitment_difficulties.csv"
      },
      "transform": [
        {"calculate": "toNumber(datum.Year)", "as": "YearNumeric"},
        {"filter": "datum.YearNumeric == Year_Selection"},
        {
          "fold": [
            "Lack of suitable applicants",
            "Undesirable working conditions",
            "Applicants lack experience",
            "Applicants lacked technical skills",
            "Lack of applicants",
            "Other reasons"
          ],
          "as": ["Difficulty", "Percentage"]
        },
        {"calculate": "toNumber(datum.Percentage)", "as": "PercentageNumeric"}
      ],
      "layer": [
        {
          "mark": {
            "type": "arc",
            "innerRadius": 100,
            "outerRadius": 180,
            "stroke": "#fff",
            "strokeWidth": 3
          },
          "encoding": {
            "theta": {"field": "PercentageNumeric", "type": "quantitative"},
            "color": {
              "field": "Difficulty",
              "type": "nominal",
              "scale": {
                "domain": [
                  "Lack of suitable applicants",
                  "Undesirable working conditions",
                  "Applicants lack experience",
                  "Applicants lacked technical skills",
                  "Lack of applicants",
                  "Other reasons"
                ],
                "range": ["#74c476", "#238b45", "#00441b", "#a1d99b", "#31a354", "#006d2c"]
              },
              "legend": {
                "title": "Main Difficulty",
                "orient": "bottom",
                "direction": "vertical",
                "labelFontSize": 12,
                "titleFontSize": 13,
                "offset": 20,
                "symbolSize": 150,
                "labelLimit": 250
              }
            },
            "tooltip": [
              {"field": "Difficulty", "type": "nominal", "title": "Difficulty"},
              {"field": "PercentageNumeric", "type": "quantitative", "title": "Percentage (%)", "format": ".1f"}
            ]
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "center",
            "baseline": "middle",
            "fontSize": 36,
            "fontWeight": "bold",
            "color": "#238b45"
          },
          "encoding": {"text": {"field": "YearNumeric"}}
        }
      ]
    }
  ]
}