{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "background": null,
  "config": {
    "font": "Fira Sans Condensed, sans-serif",
    "view": {"stroke": null}
  },
  "params": [
    {
      "name": "Year_Selection",
      "value": 2025,
      "bind": {
        "input": "range",
        "min": 2020,
        "max": 2025,
        "step": 1,
        "name": "Choose Year:"
      }
    }
  ],
  "spacing": 80,
  "align": "center",
  "center": true,
  "hconcat": [
    {
      "vconcat": [
        {
          "width": 300,
          "height": 300,
          "title": {"text": "Reason for Recruiting", "anchor": "middle", "fontSize": 16},
          "data": {
            "url": "https://raw.githubusercontent.com/enoki05/3179/refs/heads/main/data/Recruitment_Reason.csv"
          },
          "transform": [
            {"calculate": "substring(datum.Year, 6, 10)", "as": "YearNumber"},
            {"calculate": "toNumber(datum.YearNumber)", "as": "YearNumeric"},
            {"filter": "datum.YearNumeric == Year_Selection"},
            {
              "fold": [
  "Turnover Only",
  "Both Turnover and New Position(s)",
  "New Position(s) only ",
  "New Position(s) only"
],
              "as": ["Reason", "Percentage"]
            },
            {"calculate": "trim(datum.Reason)", "as": "ReasonClean"},
            {"calculate": "replace(replace(trim(datum.Percentage), '%', ''), ',', '.')", "as": "PercentageClean"},
            {"calculate": "toNumber(datum.PercentageClean)", "as": "PercentageNumeric"},
            {"filter": "isValid(datum.PercentageNumeric)"},
            {
              "calculate": "datum.ReasonClean == 'Turnover Only' ? '#74c476' : (datum.ReasonClean == 'Both Turnover and New Position(s)' ? '#238b45' : '#00441b')",
              "as": "ReasonColor"
            }
          ],
          "layer": [
            {
              "mark": {
                "type": "arc",
                "innerRadius": 70,
                "outerRadius": 130,
                "stroke": "#fff",
                "strokeWidth": 3
              },
              "encoding": {
                "theta": {
                  "field": "PercentageNumeric", 
                  "type": "quantitative",
                  "stack": true
                },
                "color": {
                  "field": "ReasonColor",
                  "type": "nominal",
                  "scale": null,
                  "legend": null
                },
                "tooltip": [
                  {"field": "ReasonClean", "type": "nominal", "title": "Reason"},
                  {"field": "PercentageNumeric", "type": "quantitative", "title": "Percentage (%)", "format": ".1f"}
                ]
              }
            },
            {
              "mark": {
                "type": "text",
                "align": "center",
                "baseline": "middle",
                "fontSize": 28,
                "fontWeight": "bold",
                "color": "#238b45"
              },
              "encoding": {"text": {"value": {"expr": "Year_Selection"}}}
            }
          ]
        },
        {
          "width": 300,
          "title": {
            "text": "Reason for Recruiting",
            "anchor": "middle",
            "fontSize": 13,
            "fontWeight": "bold",
            "offset": 15
          },
          "data": {
            "values": [
              {"label": "Turnover Only", "color": "#74c476", "order": 0},
              {"label": "Both Turnover and New Position(s)", "color": "#238b45", "order": 1},
              {"label": "New Position(s) only", "color": "#00441b", "order": 2}
            ]
          },
          "encoding": {
            "y": {
              "field": "order", 
              "type": "quantitative", 
              "axis": null,
              "scale": {"domain": [-0.5, 2.5]}
            }
          },
          "layer": [
            {
              "mark": {"type": "point", "filled": true, "size": 200},
              "encoding": {
                "x": {"value": 50},
                "color": {"field": "color", "type": "nominal", "scale": null, "legend": null}
              }
            },
            {
              "mark": {"type": "text", "align": "left", "fontSize": 11},
              "encoding": {
                "x": {"value": 65},
                "text": {"field": "label", "type": "nominal"}
              }
            }
          ]
        }
      ]
    },
    {
      "vconcat": [
        {
          "width": 300,
          "height": 300,
          "title": {"text": "Recruitment Difficulties", "anchor": "middle", "fontSize": 16},
          "data": {
            "url": "https://raw.githubusercontent.com/enoki05/3179/refs/heads/main/data/recruitment_difficulties.csv"
          },
          "transform": [
            {"calculate": "toNumber(datum.Year)", "as": "YearNumeric"},
            {"filter": "datum.YearNumeric == Year_Selection"},
            {
              "fold": [
                "Lack of suitable applicants",
                "Undesirable working conditions",
                "Applicants lack experience",
                "Applicants lacked technical skills",
                "Lack of applicants",
                "Other reasons"
              ],
              "as": ["Difficulty", "Percentage"]
            },
            {"calculate": "toNumber(datum.Percentage)", "as": "PercentageNumeric"},
            {
              "calculate": "datum.Difficulty == 'Lack of suitable applicants' ? '#e3e6e8' : (datum.Difficulty == 'Undesirable working conditions' ? '#d4ecfc' : (datum.Difficulty == 'Applicants lack experience' ? '#5a8cad' : (datum.Difficulty == 'Applicants lacked technical skills' ? '#0d2a3d' : (datum.Difficulty == 'Lack of applicants' ? '#08306b' : '#02121c'))))",
              "as": "DifficultyColor"
            }
          ],
          "layer": [
            {
              "mark": {
                "type": "arc",
                "innerRadius": 70,
                "outerRadius": 130,
                "stroke": "#fff",
                "strokeWidth": 3
              },
              "encoding": {
                "theta": {
                  "field": "PercentageNumeric", 
                  "type": "quantitative",
                  "stack": true
                },
                "color": {
                  "field": "DifficultyColor",
                  "type": "nominal",
                  "scale": null,
                  "legend": null
                },
                "tooltip": [
                  {"field": "Difficulty", "type": "nominal", "title": "Difficulty"},
                  {"field": "PercentageNumeric", "type": "quantitative", "title": "Percentage (%)", "format": ".1f"}
                ]
              }
            },
            {
              "mark": {
                "type": "text",
                "align": "center",
                "baseline": "middle",
                "fontSize": 28,
                "fontWeight": "bold",
                "color": "#2171b5"
              },
              "encoding": {"text": {"value": {"expr": "Year_Selection"}}}
            }
          ]
        },
        {
          "width": 300,
          "title": {
            "text": "Recruitment Difficulties",
            "anchor": "middle",
            "fontSize": 13,
            "fontWeight": "bold",
            "offset": 15
          },
          "data": {
            "values": [
              {"label": "Lack of suitable applicants", "color": "#e3e6e8", "order": 0},
              {"label": "Undesirable working conditions", "color": "#d4ecfc", "order": 1},
              {"label": "Applicants lack experience", "color": "#5a8cad", "order": 2},
              {"label": "Applicants lacked technical skills", "color": "#294f69", "order": 3},
              {"label": "Lack of applicants", "color": "#0d2a3d", "order": 4},
              {"label": "Other reasons", "color": "#02121c", "order": 5}
            ]
          },
          "encoding": {
            "y": {
              "field": "order", 
              "type": "quantitative", 
              "axis": null,
              "scale": {"domain": [-0.5, 5.5]}
            }
          },
          "layer": [
            {
              "mark": {"type": "point", "filled": true, "size": 200},
              "encoding": {
                "x": {"value": 30},
                "color": {"field": "color", "type": "nominal", "scale": null, "legend": null}
              }
            },
            {
              "mark": {"type": "text", "align": "left", "fontSize": 11},
              "encoding": {
                "x": {"value": 45},
                "text": {"field": "label", "type": "nominal"}
              }
            }
          ]
        }
      ]
    },
    {
      "vconcat": [
        {
          "width": 300,
          "height": 300,
          "title": {"text": "Number of Recruitment Stages", "anchor": "middle", "fontSize": 16},
          "data": {
            "url": "https://raw.githubusercontent.com/enoki05/3179/refs/heads/main/data/recruitment_stages.csv"
          },
          "transform": [
            {"calculate": "toNumber(datum.Year)", "as": "YearNumeric"},
            {"filter": "datum.YearNumeric == Year_Selection"},
            {
              "fold": [
                "1-2 Stages",
                "3-4 Stages",
                "5+ Stages"
              ],
              "as": ["Stages", "Percentage"]
            },
            {"calculate": "toNumber(datum.Percentage)", "as": "PercentageNumeric"},
            {
              "calculate": "datum.Stages == '1-2 Stages' ? '#d4b9da' : (datum.Stages == '3-4 Stages' ? '#9e3b9a' : '#67001f')",
              "as": "StagesColor"
            }
          ],
          "layer": [
            {
              "mark": {
                "type": "arc",
                "innerRadius": 70,
                "outerRadius": 130,
                "stroke": "#fff",
                "strokeWidth": 3
              },
              "encoding": {
                "theta": {
                  "field": "PercentageNumeric", 
                  "type": "quantitative",
                  "stack": true
                },
                "color": {
                  "field": "StagesColor",
                  "type": "nominal",
                  "scale": null,
                  "legend": null
                },
                "tooltip": [
                  {"field": "Stages", "type": "nominal", "title": "Number of Stages"},
                  {"field": "PercentageNumeric", "type": "quantitative", "title": "Percentage (%)", "format": ".1f"}
                ]
              }
            },
            {
              "mark": {
                "type": "text",
                "align": "center",
                "baseline": "middle",
                "fontSize": 28,
                "fontWeight": "bold",
                "color": "#9e3b9a"
              },
              "encoding": {"text": {"value": {"expr": "Year_Selection"}}}
            }
          ]
        },
        {
          "width": 300,
          "title": {
            "text": "Number of Recruitment Stages",
            "anchor": "middle",
            "fontSize": 13,
            "fontWeight": "bold",
            "offset": 15
          },
          "data": {
            "values": [
              {"label": "1-2 Stages", "color": "#d4b9da", "order": 0},
              {"label": "3-4 Stages", "color": "#9e3b9a", "order": 1},
              {"label": "5+ Stages", "color": "#67001f", "order": 2}
            ]
          },
          "encoding": {
            "y": {
              "field": "order", 
              "type": "quantitative", 
              "axis": null,
              "scale": {"domain": [-0.5, 2.5]}
            }
          },
          "layer": [
            {
              "mark": {"type": "point", "filled": true, "size": 200},
              "encoding": {
                "x": {"value": 65},
                "color": {"field": "color", "type": "nominal", "scale": null, "legend": null}
              }
            },
            {
              "mark": {"type": "text", "align": "left", "fontSize": 11},
              "encoding": {
                "x": {"value": 80},
                "text": {"field": "label", "type": "nominal"}
              }
            }
          ]
        }
      ]
    }
  ]
}